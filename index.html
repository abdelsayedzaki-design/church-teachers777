<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ù„ÙˆØ­Ø© Ø§Ù„Ø®Ø¯Ø§Ù…">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/4230/4230633.png">
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/4230/4230633.png">

    <title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: white; margin: 0; padding: 10px; -webkit-tap-highlight-color: transparent; }
        #login { position: fixed; inset: 0; background: #1e293b; display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .login-box { background: #334155; padding: 25px; border-radius: 20px; text-align: center; border: 2px solid #6366f1; width: 85%; max-width: 320px; }
        #admin { display: none; max-width: 900px; margin: auto; padding-bottom: 50px; }
        
        .top-control { display: flex; justify-content: space-between; align-items: center; background: #1e293b; padding: 10px 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #334155; position: sticky; top: 10px; z-index: 99; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .section { background: #1e293b; padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #334155; }
        .psy-section-red { background: #450a0a; padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #ef4444; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(115px, 1fr)); gap: 10px; }
        .card { background: #0f172a; padding: 10px; border-radius: 12px; text-align: center; border: 1px solid #1e293b; border-top: 3px solid #fbbf24; transition: 0.3s; }
        
        button { border: none; border-radius: 6px; cursor: pointer; color: white; transition: 0.2s; }
        .btn-edit-mode { background: #6366f1; padding: 8px 20px; font-weight: bold; }
        .btn-reset { background: #ef4444; padding: 8px 15px; font-weight: bold; display: none; }
        
        .edit-tools { display: none; margin-top: 10px; border-top: 1px solid #334155; padding-top: 10px; }
        .plus-minus { display: flex; gap: 4px; margin-bottom: 8px; flex-wrap: wrap; }
        .plus-minus button { flex: 1; padding: 5px; font-weight: bold; font-size: 11px; }
        
        input, textarea, select { padding: 10px; border-radius: 8px; border: none; outline: none; background: #0f172a; color: white; width: 100%; box-sizing: border-box; font-size: 16px; margin-bottom: 5px; }
        .add-area { display: none; background: #334155; padding: 10px; border-radius: 10px; margin-bottom: 15px; gap: 10px; }
        .add-area-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 8px; margin-bottom: 8px; }
        
        .log-box { height: 110px; overflow-y: auto; font-size: 11px; background: #020617; padding: 8px; border-radius: 8px; color: #94a3b8; border: 1px dashed #334155; line-height: 1.6; }
        .chat-area { height: 120px; overflow-y: auto; background: #0f172a; padding: 8px; border-radius: 8px; font-size: 12px; margin-top: 10px; border: 1px solid #334155; }

        .psy-card { background: #1e293b; padding: 12px; border-radius: 10px; margin-bottom: 10px; border: 1px solid #450a0a; border-right: 5px solid #ef4444; }
        .psy-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #334155; padding-bottom: 5px; margin-bottom: 8px; }
        .responded-msg { background: #064e3b !important; border-right-color: #22c55e !important; opacity: 0.8; }
        .check-area { display: flex; align-items: center; gap: 5px; font-size: 12px; cursor: pointer; }
        .check-area input { width: 18px; height: 18px; cursor: pointer; }

        .lib-admin input { margin-bottom: 8px; border: 1px solid #334155; }
        .status-toggle { display: flex; justify-content: space-between; align-items: center; background: rgba(16, 185, 129, 0.1); padding: 8px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #10b981; }

        .quiz-card { border: 2px solid #fbbf24; border-right: 8px solid #fbbf24; display: none; }
        .tab-container { display: flex; gap: 5px; margin-bottom: 15px; }
        .tab-btn { flex: 1; padding: 12px; border-radius: 8px; border: none; cursor: pointer; background: #334155; color: white; font-weight: bold; font-size: 13px; }
        .active-tab { background: #fbbf24 !important; color: #0f172a !important; }
        .opt-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px; }
        button.main-btn { width: 100%; padding: 15px; border-radius: 10px; border: none; font-weight: bold; font-size: 16px; cursor: pointer; color: white; }

        .prayer-report-card { background: #0f172a; padding: 12px; border-radius: 10px; margin-bottom: 10px; border-right: 5px solid #fbbf24; font-size: 13px; }
        .duration-badge { background: #fbbf24; color: #0f172a; padding: 2px 8px; border-radius: 5px; font-weight: bold; float: left; }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø¥Ø¶Ø§ÙÙŠ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© */
        .ans-detail-box { font-size: 11px; background: rgba(0,0,0,0.3); padding: 5px; border-radius: 5px; margin-top: 5px; border: 1px solid #334155; }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ù‚Ø³Ù… Ø§Ù„ØªØ´Ø¬ÙŠØ¹ */
        .encouragement-section { background: linear-gradient(135deg, #450a0a 0%, #7f1d1d 100%); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 3px solid #ef4444; }
        .inactive-card { background: #1e293b; padding: 15px; border-radius: 12px; margin-bottom: 12px; border-right: 5px solid #fbbf24; transition: 0.3s; }
        .inactive-card:hover { background: #334155; transform: translateX(-5px); }
        .inactive-badge { background: #ef4444; color: white; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: bold; display: inline-block; margin-bottom: 8px; }
        .contact-btn { background: #22c55e; color: white; padding: 8px 15px; border-radius: 8px; font-size: 12px; font-weight: bold; margin-top: 8px; cursor: pointer; }
        .contact-btn:hover { background: #16a34a; }
    </style>
</head>
<body>

<div id="login">
    <div class="login-box">
        <h3 style="margin-top:0;">â€  Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø®Ø¯Ø§Ù… â€ </h3>
        <input type="password" id="passInput" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
        <button onclick="checkPass()" style="background: #22c55e; width: 100%; padding: 12px; margin-top: 15px; font-weight: bold; border-radius: 8px;">Ø¯Ø®ÙˆÙ„</button>
    </div>
</div>

<div id="admin">
    <div style="text-align: center; margin-bottom: 15px;">
        <h3 style="margin:0; color:#818cf8;">Ø¥Ø¯Ø§Ø±Ø© Ø®Ø¯Ù…Ø© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</h3>
        <small id="welcomeServant" style="color: #fbbf24; font-weight: bold;"></small>
    </div>

    <div class="section" style="border: 2px solid #fbbf24; display: flex; justify-content: space-between; align-items: center; background: rgba(251, 191, 36, 0.1);">
        <span style="font-weight: bold; color: #fbbf24;">Ø¸Ù‡ÙˆØ± Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ù„Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ†:</span>
        <button id="quizVisibilityBtn" onclick="toggleQuizVisibility()" style="padding: 10px 20px; font-weight: bold; background: #ef4444; border-radius: 8px; color: white;">Ù…Ø®ÙÙŠØ© Ø§Ù„Ø¢Ù† âŒ</button>
    </div>

    <button onclick="toggleQuizSection()" style="width: 100%; padding: 12px; margin-bottom: 15px; background: #334155; color: #fbbf24; font-weight: bold; border-radius: 10px; border: 1px solid #fbbf24; cursor: pointer;">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬</button>

    <div id="quizSection" class="section quiz-card">
        <h3 style="text-align: center; color: #fbbf24; margin-top: 0;">ğŸ“– Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h3>
        
        <div class="tab-container">
            <button onclick="switchTab('manual')" id="tabManual" class="tab-btn active-tab">âœï¸ ÙŠØ¯ÙˆÙŠ</button>
            <button onclick="switchTab('net')" id="tabNet" class="tab-btn">ğŸš€ ØµØ§Ø±ÙˆØ®</button>
            <button onclick="switchTab('res')" id="tabRes" class="tab-btn">ğŸ“Š Ù†ØªØ§Ø¦Ø¬</button>
        </div>

        <div style="background: rgba(251, 191, 36, 0.1); padding: 10px; border-radius: 8px; margin-bottom: 15px; border: 1px dashed #fbbf24;">
            <label style="font-size: 12px; color: #fbbf24; display: block; margin-bottom: 5px;">â±ï¸ ÙˆÙ‚Øª Ø­Ù„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚):</label>
            <div style="display: flex; gap: 5px;">
                <input type="number" id="quizTimerInp" placeholder="Ù…Ø«Ø§Ù„: 5" style="flex: 1; margin-bottom: 0;">
                <button onclick="saveQuizTimer()" style="background: #fbbf24; color: #0f172a; padding: 0 15px; font-weight: bold; border-radius: 8px;">Ø­ÙØ¸ Ø§Ù„ÙˆÙ‚Øª</button>
            </div>
        </div>

        <div id="viewManual">
            <select id="qType" onchange="toggleManualFields()">
                <option value="choice">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯</option>
                <option value="truefalse">ØµØ­ Ø£Ù… Ø®Ø·Ø£</option>
                <option value="text">Ø£ÙƒÙ…Ù„ (Ù†Øµ Ù‚ØµÙŠØ±)</option>
                <option value="essay">Ø³Ø¤Ø§Ù„ Ù…Ù‚Ø§Ù„ÙŠ (Ø´Ø±Ø­)</option>
            </select>
            <input type="text" id="mQuestion" placeholder="Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„">
            
            <input type="number" id="mPoints" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ (Ù…Ø«Ø§Ù„: 5)" style="border: 1px solid #fbbf24; background: #1e293b;">

            <div id="choiceArea">
                <div class="opt-row"><input type="radio" name="correctRadio" value="0" checked><input type="text" id="opt0" placeholder="Ø®ÙŠØ§Ø± 1"></div>
                <div class="opt-row"><input type="radio" name="correctRadio" value="1"><input type="text" id="opt1" placeholder="Ø®ÙŠØ§Ø± 2"></div>
                <div class="opt-row"><input type="radio" name="correctRadio" value="2"><input type="text" id="opt2" placeholder="Ø®ÙŠØ§Ø± 3"></div>
                <div class="opt-row"><input type="radio" name="correctRadio" value="3"><input type="text" id="opt3" placeholder="Ø®ÙŠØ§Ø± 4"></div>
            </div>

            <div id="tfArea" style="display:none; text-align: center; padding: 10px;">
                <label><input type="radio" name="tfRadio" value="ØµØ­" checked> ØµØ­</label>
                <label style="margin-right:20px;"><input type="radio" name="tfRadio" value="Ø®Ø·Ø£"> Ø®Ø·Ø£</label>
            </div>

            <div id="textOnlyArea" style="display:none;">
                <input type="text" id="manualAns" placeholder="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© (Ø§ØªØ±Ùƒ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„Ù…Ù‚Ø§Ù„ÙŠ)">
            </div>

            <button onclick="saveManualQuestion()" class="main-btn" style="background: #22c55e;">Ø­ÙØ¸ Ø§Ù„Ø³Ø¤Ø§Ù„ âœ…</button>
        </div>

        <div id="viewNet" style="display: none;">
            <textarea id="bulkInput" rows="5" placeholder="Ø§Ù„Ø³Ø¤Ø§Ù„ | Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© | Ø§Ù„Ù†Ù‚Ø§Ø· (Ù…Ø«Ø§Ù„: Ù…Ù† Ù‡Ùˆ Ø£ÙˆÙ„ Ø§Ù„Ø´Ù‡Ø¯Ø§Ø¡ØŸ | Ø§Ø³ØªÙØ§Ù†ÙˆØ³ | 5)"></textarea>
            <button onclick="saveBulkNet()" class="main-btn" style="background: #6366f1; margin-top: 10px;">Ø¥Ø¶Ø§ÙØ© Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø© ğŸš€</button>
        </div>

        <div id="viewRes" style="display: none;">
            <div id="resList" style="max-height: 250px; overflow-y: auto; background: #020617; padding: 10px; border-radius: 8px; margin-bottom: 10px;"></div>
            <div style="background: rgba(239, 68, 68, 0.1); padding: 12px; border-radius: 8px; margin-bottom: 10px; border: 1px dashed #ef4444;">
                <p style="font-size: 12px; color: #fca5a5; margin: 0 0 8px 0; line-height: 1.6;">
                    âš ï¸ Ø§Ù„ØªØµÙÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ ÙŠÙ…Ø³Ø­:<br>
                    âœ… ÙƒÙ„ Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© (Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙˆØ§Ù„Ø¬Ø¯ÙŠØ¯)<br>
                    âœ… ÙŠØ³Ù…Ø­ Ù„ÙƒÙ„ Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ† Ø¨Ø§Ù„Ø­Ù„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                </p>
            </div>
            <button onclick="confirmClearQuiz()" style="background:#ef4444;" class="main-btn">ğŸ—‘ï¸ ØªØµÙÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (Ø´Ø§Ù…Ù„)</button>
        </div>
    </div>

    <div class="encouragement-section">
        <h3 style="margin: 0 0 15px 0; color: #fbbf24; text-align: center;">ğŸ’™ Ù…Ø­ØªØ§Ø¬ÙŠÙ†Ùƒ Ù…Ø¹Ø§Ù†Ø§ - Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ† Ø§Ù„ØºÙŠØ± Ù†Ø´Ø·ÙŠÙ†</h3>
        <p style="text-align: center; font-size: 13px; color: #fcd34d; margin-bottom: 15px;">
            Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ† Ø¯ÙˆÙ„ Ù…Ø­ØªØ§Ø¬ÙŠÙ† ØªØ´Ø¬ÙŠØ¹ Ù…Ù†Ùƒ! ğŸŒŸ
        </p>
        
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <button onclick="sendEncouragementToAll()" style="flex: 1; background: #22c55e; padding: 12px; font-weight: bold; border-radius: 10px; font-size: 14px;">
                ğŸ“¨ Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ø¦Ù„ ØªØ´Ø¬ÙŠØ¹ÙŠØ© Ù„Ù„ÙƒÙ„
            </button>
            <button onclick="toggleInactiveList()" style="flex: 1; background: #6366f1; padding: 12px; font-weight: bold; border-radius: 10px; font-size: 14px;">
                ğŸ‘€ Ø´ÙˆÙ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            </button>
        </div>
        
        <div id="inactiveList" style="display: none; max-height: 350px; overflow-y: auto; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px;">
            <p style="text-align: center; color: #94a3b8; font-size: 12px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        </div>
    </div>

    <div class="top-control">
        <button id="modeBtn" onclick="toggleEditMode()" class="btn-edit-mode">ğŸ“ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
        <button id="resetBtn" onclick="resetAllScores()" class="btn-reset">ğŸ”„ ØªØµÙÙŠØ± Ø§Ù„ÙƒÙ„</button>
    </div>

    <div class="section" style="border-top: 4px solid #fbbf24;">
        <h4 style="margin: 0 0 10px 0; color: #fbbf24;">ğŸ† Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ†</h4>
        <input type="text" id="searchInput" onkeyup="searchMakhdoum()" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù…..." style="margin-bottom:10px; background:#334155;">
        <div id="addArea" class="add-area">
            <div class="add-area-grid">
                <input type="text" id="nameInp" placeholder="Ø§Ø³Ù… Ù…Ø®Ø¯ÙˆÙ… Ø¬Ø¯ÙŠØ¯..." style="flex:1;">
                <input type="tel" id="phoneInp" placeholder="Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†" style="flex:1;">
            </div>
            <button onclick="addNewMakhdoum()" style="background:#22c55e; padding:10px 15px; font-weight:bold;">Ø¥Ø¶Ø§ÙØ©</button>
        </div>
        <div id="leaderboard" class="grid"></div>
    </div>

    <div class="section" style="border: 2px solid #10b981; background: rgba(16, 185, 129, 0.05);">
        <h4 style="margin: 0 0 15px 0; color: #10b981;">ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ Ù…Ø®Ø¯ÙˆÙ…</h4>
        <div id="pointsBreakdownList" style="max-height: 400px; overflow-y: auto;"></div>
    </div>

    <div class="section" style="border-right: 4px solid #22c55e;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h4 style="margin:0;">ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ†</h4>
            <div style="display:flex; gap:5px;">
                <button id="chatStatusBtn" onclick="toggleChat()" style="font-size:10px; padding:6px 10px; font-weight:bold;"></button>
                <button onclick="clearChatMessages()" style="background:#ef4444; font-size:10px; padding:6px 10px;">Ù…Ø­Ùˆ Ø§Ù„Ø´Ø§Øª ğŸ—‘ï¸</button>
            </div>
        </div>
        <div id="adminChat" class="chat-area"></div>
        <div style="display:flex; gap:5px; margin-top:10px;">
            <input type="text" id="adminReplyInp" placeholder="Ø§ÙƒØªØ¨ Ø±Ø¯Ùƒ ÙƒØ®Ø§Ø¯Ù… Ù‡Ù†Ø§...">
            <button onclick="sendAdminReply()" style="background:#22c55e; padding:0 20px; font-weight:bold;">Ø±Ø¯</button>
        </div>
    </div>

    <div class="psy-section-red">
        <h4 style="margin:0; color:#ffedd5; border-bottom: 1px solid #ef4444; padding-bottom: 5px;">ğŸš¨ Ø±ÙƒÙ† Ø§Ù„Ù…Ø³Ø§Ù†Ø¯Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©</h4>
        <div id="psyList" style="margin-top:10px;"></div>
        
        <h5 style="color: #fbbf24; margin: 15px 0 5px 0; border-bottom: 1px solid #334155; font-size: 14px;">ğŸ’¬ Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ø¬Ù‡ÙˆÙ„Ø©</h5>
        <div id="adminPsyChats" style="max-height: 250px; overflow-y: auto;"></div>
    </div>

    <div class="section" style="border: 2px solid #fbbf24; background: rgba(251, 191, 36, 0.05);">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h4 style="margin:0; color:#fbbf24;">ğŸ“¥ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø°Ø¨Ø­ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠ</h4>
            <button onclick="clearPrayerReports()" style="background:#ef4444; font-size:10px; padding:5px 10px;">Ù…Ø³Ø­ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ğŸ—‘ï¸</button>
        </div>
        <div id="prayerReportsList" style="max-height: 300px; overflow-y: auto; background: #020617; padding: 10px; border-radius: 10px;">
            <p style="text-align:center; color:gray; font-size:12px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±...</p>
        </div>
    </div>

    <div class="section" style="border-right: 4px solid #6366f1;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
            <h4 style="margin:0;">ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ø­Ø±ÙƒØ§Øª</h4>
            <button onclick="clearLog()" style="background:#ef4444; font-size:10px; padding:2px 8px;">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ ğŸ—‘ï¸</button>
        </div>
        <div class="log-box" id="actionLog"></div>
    </div>

    <div class="normal-alert-box section">
        <h4 style="margin:0 0 10px 0; color:#818cf8;">ğŸ“¢ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ†</h4>
        <textarea id="alertContent" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ù†Ø§..." style="height:60px; margin-bottom:10px;"></textarea>
        <div style="display:flex; gap:5px;">
            <button onclick="sendAlert()" style="background:#6366f1; flex:2; padding:10px; font-weight:bold;">Ù†Ø´Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</button>
            <button onclick="clearAlert()" style="background:#475569; flex:1; padding:10px;">Ø­Ø°Ù</button>
        </div>
    </div>

    <div class="section lib-admin" style="border: 2px solid #10b981;">
        <h4 style="margin:0 0 10px 0; color:#10b981;">ğŸ¥ Ø¥Ø¯Ø§Ø±Ø© Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…ÙŠØ¯ÙŠØ§</h4>
        
        <div class="status-toggle">
            <span style="font-size:13px; color:#10b981; font-weight:bold;">Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙƒØªØ¨Ø© Ù„Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ†:</span>
            <button id="libStatusBtn" onclick="toggleLibVisibility()" style="padding:5px 12px; font-size:11px; font-weight:bold;"></button>
        </div>

        <div style="background: rgba(0,0,0,0.1); padding: 10px; border-radius: 8px;">
            <label style="font-size:12px; color:#94a3b8;">Ø±Ø§Ø¨Ø· Ù„Ø­Ù† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:</label>
            <input type="text" id="hymnUrl" placeholder="Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ Ù‡Ù†Ø§">
            
            <label style="font-size:12px; color:#94a3b8;">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†Ù‡Ø¬ (PDF):</label>
            <input type="text" id="pdfUrl" placeholder="Ø±Ø§Ø¨Ø· Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ">
            
            <label style="font-size:12px; color:#94a3b8;">Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¯Ø±Ø³:</label>
            <input type="text" id="videoUrl" placeholder="Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¯Ø±Ø³">
            
            <button onclick="updateMediaLinks()" style="background:#10b981; width:100%; padding:12px; font-weight:bold; margin-top:5px; border-radius:8px;">ğŸ’¾ Ø­ÙØ¸ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</button>
        </div>
    </div>

    <div id="adminPrayerControl" style="background: #1e293b; padding: 20px; border-radius: 15px; border: 2px solid #4ade80; margin: 20px 0; font-family: 'Segoe UI', sans-serif; color: white; direction: rtl;">
        <h3 style="color: #4ade80; text-align: center; margin-top: 0;">ğŸ› ï¸ ØªØ­ÙƒÙ… ÙÙŠ Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ù…Ø°Ø¨Ø­ Ø§Ù„ØµÙ„Ø§Ø©</h3>
        <p style="text-align: center; font-size: 13px; color: #cbd5e1;">Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„ØªÙŠ Ø³ØªÙƒØªØ¨Ù‡Ø§ Ù‡Ù†Ø§ Ø³ØªØ¸Ù‡Ø± Ù„Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ† ØªØ­Øª ÙƒÙ„ Ø¨Ù†Ø¯ Ù„ØªÙˆØ¬ÙŠÙ‡Ù‡Ù… ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø©.</p>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div><label style="display:block; margin-bottom:5px; color:#fbbf24;">ğŸ“– Ø¥Ø±Ø´Ø§Ø¯ Ø§Ù„Ø£Ø¬Ø¨ÙŠØ©:</label><input type="text" id="adm_agpeya" style="width:100%; padding:10px; border-radius:8px; border:1px solid #334155; background:#0f172a; color:white;"></div>
            <div><label style="display:block; margin-bottom:5px; color:#fbbf24;">ğŸ•Šï¸ Ø¥Ø±Ø´Ø§Ø¯ Ø§Ù„Ø´ÙƒØ±:</label><input type="text" id="adm_thanks" style="width:100%; padding:10px; border-radius:8px; border:1px solid #334155; background:#0f172a; color:white;"></div>
            <div><label style="display:block; margin-bottom:5px; color:#fbbf24;">ğŸ™ Ø¥Ø±Ø´Ø§Ø¯ Ø§Ù„Ù…ØºÙØ±Ø©:</label><input type="text" id="adm_forgive" style="width:100%; padding:10px; border-radius:8px; border:1px solid #334155; background:#0f172a; color:white;"></div>
            <div><label style="display:block; margin-bottom:5px; color:#fbbf24;">â¤ï¸ Ø¥Ø±Ø´Ø§Ø¯ Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„Ù…Ù„ØªÙ‡Ø¨:</label><input type="text" id="adm_heart" style="width:100%; padding:10px; border-radius:8px; border:1px solid #334155; background:#0f172a; color:white;"></div>
            <div><label style="display:block; margin-bottom:5px; color:#fbbf24;">ğŸ”— Ø¥Ø±Ø´Ø§Ø¯ Ø§Ù„Ø§ØªØ­Ø§Ø¯ Ø¨Ø§Ù„Ø±Ø¨:</label><input type="text" id="adm_union" style="width:100%; padding:10px; border-radius:8px; border:1px solid #334155; background:#0f172a; color:white;"></div>
            <div><label style="display:block; margin-bottom:5px; color:#fbbf24;">ğŸ“œ Ø¥Ø±Ø´Ø§Ø¯ Ø¢ÙŠØ© Ø§Ù„ÙŠÙˆÙ…:</label><input type="text" id="adm_verse" style="width:100%; padding:10px; border-radius:8px; border:1px solid #334155; background:#0f172a; color:white;"></div>
        </div>
        <button onclick="updatePrayerHints()" style="width: 100%; margin-top: 20px; padding: 15px; background: #4ade80; color: #0f172a; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 16px;">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ† Ø§Ù„Ø¢Ù† ğŸš€</button>
    </div>
</div>

<script>
    const config = { databaseURL: "https://jesus-bb0ba-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(config);
    const db = firebase.database();
    
    const users = { "jesus": "Ø£Ù…ÙŠÙ† Ø§Ù„Ø®Ø¯Ù…Ø©", "mikel": "Ø£/ Ù…ÙŠÙƒØ§Ø¦ÙŠÙ„", "john": "Ø£/ ÙŠÙˆØ­Ù†Ø§", "servant": "Ø®Ø§Ø¯Ù… Ø¹Ø§Ù…" };
    let localData = []; let isEditMode = false; let currentServant = "";

    function checkPass() {
        const input = document.getElementById('passInput').value.trim().toLowerCase();
        if(users[input]) {
            currentServant = users[input];
            document.getElementById('login').style.display = 'none';
            document.getElementById('admin').style.display = 'block';
            document.getElementById('welcomeServant').innerText = "Ø£Ù‡Ù„Ø§Ù‹ ÙŠØ§ " + currentServant;
            startListening();
            loadCurrentHints(); 
            listenToPrayerReports();
        } else { alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø·Ø£!"); }
    }

    function startListening() {
        listenQuizStatus(); 
        loadPointsBreakdown();
        db.ref("settings/quizTimer").on("value", snap => { if(snap.exists()) document.getElementById('quizTimerInp').value = snap.val(); });
        db.ref("points_data").on("value", snap => {
            const data = snap.val();
            localData = data ? Object.keys(data).map(k => ({id:k, ...data[k]})) : [];
            renderUI();
            loadPointsBreakdown(); // ØªØ­Ø¯ÙŠØ« ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
        });
        db.ref("media_library").on("value", snap => {
            const d = snap.val();
            if(d) {
                document.getElementById('hymnUrl').value = d.hymn || "";
                document.getElementById('pdfUrl').value = d.pdf || "";
                document.getElementById('videoUrl').value = d.video || "";
            }
        });
        db.ref("settings/libVisible").on("value", snap => {
            const isVisible = snap.val() !== false;
            const btn = document.getElementById('libStatusBtn');
            btn.innerText = isVisible ? "Ø¸Ø§Ù‡Ø±Ø© Ø§Ù„Ø¢Ù† âœ…" : "Ù…Ø®ÙÙŠØ© Ø§Ù„Ø¢Ù† âŒ";
            btn.style.background = isVisible ? "#22c55e" : "#ef4444";
        });
        db.ref("activity_logs").limitToLast(20).on("value", snap => {
            const box = document.getElementById('actionLog'); box.innerHTML = "";
            snap.forEach(l => { box.innerHTML = `<div>${l.val()}</div>` + box.innerHTML; });
        });
        db.ref("settings/chatEnabled").on("value", snap => {
            const status = snap.val() !== false;
            const btn = document.getElementById('chatStatusBtn');
            btn.innerText = status ? "Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ğŸ”´" : "ÙØªØ­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ğŸŸ¢";
            btn.style.background = status ? "#ef4444" : "#22c55e";
        });
        db.ref("chat").limitToLast(15).on("value", snap => {
            const box = document.getElementById('adminChat'); box.innerHTML = "";
            snap.forEach(m => { 
                const sender = m.val().sender;
                const isServant = sender.includes("Ø£/") || sender.includes("Ø£Ù…ÙŠÙ†");
                const color = isServant ? "#fbbf24" : "#818cf8";
                box.innerHTML += `<div><b style="color:${color};">${sender}:</b> ${m.val().text}</div>`; 
            });
            box.scrollTop = box.scrollHeight;
        });
        db.ref("psychology/confessions").on("value", snap => {
            const box = document.getElementById('psyList'); box.innerHTML = "";
            snap.forEach(c => {
                const val = c.val(); const key = c.key;
                box.innerHTML += `<div class="psy-card ${val.responded ? 'responded-msg' : ''}">
                    <div class="psy-header"><b style="color:#f472b6;">${val.sender} [${val.mood || ''}]</b>
                    <label class="check-area"><input type="checkbox" ${val.responded ? 'checked' : ''} onchange="togglePsyResponse('${key}', this.checked)"> ØªÙ… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</label></div>
                    <p style="margin:2px 0; font-size:12px; color:#fbbf24;">Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬: ${val.need || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    <p style="margin:5px 0; font-size:14px;">${val.text}</p>
                    <div style="text-align: left; margin-top:5px;"><button onclick="deletePsyMsg('${key}')" style="background:none; color:#f87171; font-size:10px;">Ø­Ø°Ù ğŸ—‘ï¸</button></div></div>`;
            });
        });
        db.ref("psychology/private_chats").on("value", snap => {
            const box = document.getElementById('adminPsyChats'); box.innerHTML = "";
            const data = snap.val();
            if(!data) { box.innerHTML = "<p style='text-align:center; color:gray; font-size:12px;'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù†Ø´Ø·Ø©</p>"; return; }
            Object.keys(data).forEach(sid => {
                const messages = data[sid];
                let sHtml = `<div style="background:#1e293b; padding:10px; border-radius:10px; margin-bottom:10px; border:1px solid #ef4444;">
                    <small style="color:#94a3b8; display:block; margin-bottom:5px;">Ø§Ù„Ø¬Ù„Ø³Ø©: ${sid}</small>
                    <div id="chatbox_${sid}" style="max-height:100px; overflow-y:auto; margin-bottom:8px; background:rgba(0,0,0,0.2); padding:5px; border-radius:5px;">`;
                Object.values(messages).forEach(m => {
                    const isServant = m.sender && m.sender.includes("Ø§Ù„Ø®Ø§Ø¯Ù…");
                    sHtml += `<div style="font-size:12px; margin-bottom:3px; color:${isServant ? '#fbbf24' : '#fff'}"><b>${m.sender}:</b> ${m.text}</div>`;
                });
                sHtml += `</div><div style="display:flex; gap:5px; margin-top:8px;">
                    <input type="text" id="rep_${sid}" placeholder="Ø±Ø¯..." style="font-size:12px; padding:5px; height:35px; background:#0f172a; border:1px solid #334155; color:white; flex-grow:1;">
                    <button onclick="replyPsy('${sid}')" style="background:#22c55e; padding:0 15px;">Ø±Ø¯</button>
                    <button onclick="delPsyChat('${sid}')" style="background:#ef4444; padding:0 10px;">ğŸ—‘ï¸</button>
                </div></div>`;
                box.innerHTML += sHtml;
            });
        });
    }

    function listenToPrayerReports() {
        db.ref("prayer_reports").on("value", snap => {
            const box = document.getElementById('prayerReportsList'); box.innerHTML = "";
            if(!snap.exists()) { box.innerHTML = "<p style='text-align:center; color:gray; font-size:12px;'>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± ØµÙ„Ø§Ø©</p>"; return; }
            snap.forEach(child => {
                const r = child.val();
                box.innerHTML = `<div class="prayer-report-card"><span class="duration-badge">â±ï¸ ${r.duration || '0 Ø¯'}</span><b style="color:#fbbf24; font-size:14px;">ğŸ‘¤ ${r.makhdom}</b><br><small style="color:#94a3b8;">ğŸ“… ${r.time}</small>
                    <div style="margin-top:8px; border-top: 1px solid #334155; padding-top:5px;"><div>ğŸ“– <b>Ø§Ù„Ø£Ø¬Ø¨ÙŠØ©:</b> ${r.agpeya || '---'}</div><div>ğŸ•Šï¸ <b>Ø´ÙƒØ±:</b> ${r.thanks || '---'}</div><div>ğŸ™ <b>ØªÙˆØ¨Ø©:</b> ${r.forgive || '---'}</div><div>â¤ï¸ <b>Ø­Ø¨:</b> ${r.heart || '---'}</div><div>ğŸ”— <b>Ø«Ø¨Ø§Øª:</b> ${r.union || '---'}</div><div style="color:#4ade80;">ğŸ“œ <b>Ø§Ù„Ø¢ÙŠØ©:</b> ${r.verse || '---'}</div></div></div>` + box.innerHTML;
            });
        });
    }

    function clearPrayerReports() { if(prompt("Ø¨Ø§Ø³ÙˆÙˆØ±Ø¯ Ù…Ø³Ø­ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±:") === "jesus 777") db.ref("prayer_reports").remove(); }

    function loadPointsBreakdown() {
        const box = document.getElementById('pointsBreakdownList');
        box.innerHTML = "<p style='text-align:center; color:gray; font-size:12px;'>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>";

        // Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        Promise.all([
            db.ref("points_data").once("value"),
            db.ref("bible_quiz/submissions").once("value"),
            db.ref("prayer_reports").once("value"),
            db.ref("attendance_logs").once("value")
        ]).then(([pointsSnap, quizSnap, prayerSnap, attendanceSnap]) => {
            const pointsData = pointsSnap.val() || {};
            
            // ØªØ¬Ù…ÙŠØ¹ Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ù…Ø¹ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
            const quizDetails = {};
            if (quizSnap.exists()) {
                quizSnap.forEach(child => {
                    const data = child.val();
                    if (!quizDetails[data.userName]) quizDetails[data.userName] = [];
                    quizDetails[data.userName].push({
                        points: data.finalPoints || data.score || 0,
                        time: data.time || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"
                    });
                });
            }

            // ØªØ¬Ù…ÙŠØ¹ Ù†Ù‚Ø§Ø· Ø§Ù„ØµÙ„Ø§Ø© Ù…Ø¹ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
            const prayerDetails = {};
            if (prayerSnap.exists()) {
                prayerSnap.forEach(child => {
                    const data = child.val();
                    if (!prayerDetails[data.makhdom]) prayerDetails[data.makhdom] = [];
                    prayerDetails[data.makhdom].push({
                        points: 5,
                        time: data.time || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"
                    });
                });
            }

            // ØªØ¬Ù…ÙŠØ¹ Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ø¶ÙˆØ± Ù…Ø¹ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
            const attendanceDetails = {};
            if (attendanceSnap.exists()) {
                attendanceSnap.forEach(child => {
                    const data = child.val();
                    const name = data.makhdom;
                    if (!attendanceDetails[name]) attendanceDetails[name] = [];
                    attendanceDetails[name].push({
                        type: data.type,
                        points: 5,
                        time: data.submittedAt || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"
                    });
                });
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            box.innerHTML = "";
            const sortedNames = Object.keys(pointsData).map(k => ({id: k, ...pointsData[k]})).sort((a,b) => b.score - a.score);
            
            if (sortedNames.length === 0) {
                box.innerHTML = "<p style='text-align:center; color:gray; font-size:12px;'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ†</p>";
                return;
            }

            sortedNames.forEach(p => {
                const name = p.name;
                const phone = p.phone || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
                const total = p.score || 0;
                
                const quizList = quizDetails[name] || [];
                const prayerList = prayerDetails[name] || [];
                const attendanceList = attendanceDetails[name] || [];
                
                const quizTotal = quizList.reduce((sum, item) => sum + item.points, 0);
                const prayerTotal = prayerList.reduce((sum, item) => sum + item.points, 0);
                const attendanceTotal = attendanceList.reduce((sum, item) => sum + item.points, 0);
                const other = total - quizTotal - prayerTotal - attendanceTotal;

                let detailsHTML = '';
                
                // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª
                if (quizList.length > 0) {
                    detailsHTML += '<div style="margin-top:10px; padding:8px; background:rgba(99,102,241,0.05); border-radius:8px; border:1px solid #6366f1;">';
                    detailsHTML += '<div style="color:#a5b4fc; font-size:11px; font-weight:bold; margin-bottom:5px;">ğŸ“– ØªÙØ§ØµÙŠÙ„ Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ù…Ù‚Ø¯Ø³:</div>';
                    quizList.forEach(item => {
                        detailsHTML += `<div style="font-size:10px; color:#cbd5e1; padding:3px 0; border-bottom:1px dashed rgba(99,102,241,0.2);">â€¢ ${item.points} Ù†Ù‚Ø·Ø© - ${item.time}</div>`;
                    });
                    detailsHTML += '</div>';
                }
                
                // ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø©
                if (prayerList.length > 0) {
                    detailsHTML += '<div style="margin-top:10px; padding:8px; background:rgba(251,191,36,0.05); border-radius:8px; border:1px solid #fbbf24;">';
                    detailsHTML += '<div style="color:#fde68a; font-size:11px; font-weight:bold; margin-bottom:5px;">ğŸ™ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø©:</div>';
                    prayerList.forEach(item => {
                        detailsHTML += `<div style="font-size:10px; color:#cbd5e1; padding:3px 0; border-bottom:1px dashed rgba(251,191,36,0.2);">â€¢ ${item.points} Ù†Ù‚Ø§Ø· - ${item.time}</div>`;
                    });
                    detailsHTML += '</div>';
                }
                
                // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
                if (attendanceList.length > 0) {
                    detailsHTML += '<div style="margin-top:10px; padding:8px; background:rgba(34,197,94,0.05); border-radius:8px; border:1px solid #22c55e;">';
                    detailsHTML += '<div style="color:#86efac; font-size:11px; font-weight:bold; margin-bottom:5px;">â›ª ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±:</div>';
                    attendanceList.forEach(item => {
                        detailsHTML += `<div style="font-size:10px; color:#cbd5e1; padding:3px 0; border-bottom:1px dashed rgba(34,197,94,0.2);">â€¢ ${item.type} - ${item.points} Ù†Ù‚Ø§Ø· - ${item.time}</div>`;
                    });
                    detailsHTML += '</div>';
                }

                box.innerHTML += `
                <div style="background: #1e293b; padding: 12px; border-radius: 10px; margin-bottom: 10px; border-right: 4px solid #10b981;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px solid #334155; padding-bottom: 8px;">
                        <div>
                            <b style="color: #fbbf24; font-size: 16px;">ğŸ‘¤ ${name}</b>
                            <div style="background: rgba(148,163,184,0.2); display: inline-block; padding: 3px 8px; border-radius: 5px; margin-right: 8px;">
                                <span style="color: #94a3b8; font-size: 11px;">ğŸ“± ${phone}</span>
                            </div>
                        </div>
                        <span style="background: #fbbf24; color: #0f172a; padding: 4px 12px; border-radius: 8px; font-weight: bold; font-size: 16px;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${total}</span>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 13px;">
                        <div style="background: rgba(99, 102, 241, 0.1); padding: 8px; border-radius: 8px; border: 1px solid #6366f1;">
                            <span style="color: #a5b4fc;">ğŸ“– Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ù…Ù‚Ø¯Ø³:</span>
                            <b style="color: #6366f1; float: left;">${quizTotal}</b>
                        </div>
                        <div style="background: rgba(251, 191, 36, 0.1); padding: 8px; border-radius: 8px; border: 1px solid #fbbf24;">
                            <span style="color: #fde68a;">ğŸ™ Ø§Ù„ØµÙ„Ø§Ø©:</span>
                            <b style="color: #fbbf24; float: left;">${prayerTotal}</b>
                        </div>
                        <div style="background: rgba(34, 197, 94, 0.1); padding: 8px; border-radius: 8px; border: 1px solid #22c55e;">
                            <span style="color: #86efac;">â›ª Ø§Ù„Ø­Ø¶ÙˆØ±:</span>
                            <b style="color: #22c55e; float: left;">${attendanceTotal}</b>
                        </div>
                        ${other > 0 ? `<div style="background: rgba(148, 163, 184, 0.1); padding: 8px; border-radius: 8px; border: 1px solid #94a3b8;">
                            <span style="color: #cbd5e1;">âœ¨ Ø£Ø®Ø±Ù‰:</span>
                            <b style="color: #94a3b8; float: left;">${other}</b>
                        </div>` : ''}
                    </div>
                    ${detailsHTML}
                    <button onclick="clearMakhdoumPointsDetails('${name}')" style="width:100%; margin-top:10px; padding:8px; background:#dc2626; color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer; font-size:11px;">ğŸ—‘ï¸ ØªØµÙÙŠØ± ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· (Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„)</button>
                </div>`;
            });
        });
    }

    function saveQuizTimer() {
        const val = document.getElementById('quizTimerInp').value;
        if(val && val > 0) db.ref("settings/quizTimer").set(parseInt(val)).then(() => alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…"));
    }

    function toggleQuizVisibility() { db.ref("settings/quizEnabled").once("value", snap => { db.ref("settings/quizEnabled").set(!(snap.val() || false)); }); }
    function listenQuizStatus() { db.ref("settings/quizEnabled").on("value", snap => {
        const isVisible = snap.val() === true;
        const btn = document.getElementById('quizVisibilityBtn');
        btn.innerText = isVisible ? "Ø¸Ø§Ù‡Ø±Ø© Ù„Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ† âœ…" : "Ù…Ø®ÙÙŠØ© Ø§Ù„Ø¢Ù† âŒ";
        btn.style.background = isVisible ? "#22c55e" : "#ef4444";
    }); }

    function toggleQuizSection() { const q = document.getElementById('quizSection'); q.style.display = (q.style.display === 'block') ? 'none' : 'block'; }

    function switchTab(tab) {
        ['manual', 'net', 'res'].forEach(t => {
            document.getElementById('view' + t.charAt(0).toUpperCase() + t.slice(1)).style.display = (tab === t) ? 'block' : 'none';
            document.getElementById('tab' + t.charAt(0).toUpperCase() + t.slice(1)).classList.toggle('active-tab', tab === t);
        });
        if(tab === 'res') loadResults();
    }

    function toggleManualFields() {
        const type = document.getElementById('qType').value;
        document.getElementById('choiceArea').style.display = (type === 'choice') ? 'block' : 'none';
        document.getElementById('tfArea').style.display = (type === 'truefalse') ? 'block' : 'none';
        document.getElementById('textOnlyArea').style.display = (type === 'text' || type === 'essay') ? 'block' : 'none';
    }

    function saveManualQuestion() {
        const type = document.getElementById('qType').value;
        const qText = document.getElementById('mQuestion').value.trim();
        const qPoints = document.getElementById('mPoints').value.trim() || 1;
        if(!qText) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¤Ø§Ù„");
        let data = { text: qText, type: type, points: parseInt(qPoints), options: [] };
        if(type === 'choice') {
            const opts = [document.getElementById('opt0').value.trim(), document.getElementById('opt1').value.trim(), document.getElementById('opt2').value.trim(), document.getElementById('opt3').value.trim()];
            data.options = opts; data.correctAnswer = opts[document.querySelector('input[name="correctRadio"]:checked').value];
        } else if(type === 'truefalse') {
            data.options = ["ØµØ­", "Ø®Ø·Ø£"]; data.correctAnswer = document.querySelector('input[name="tfRadio"]:checked').value;
        } else if(type === 'essay') {
            data.options = [""]; data.correctAnswer = "Ù…Ø±Ø§Ø¬Ø¹Ø© Ø®Ø§Ø¯Ù…"; 
        } else {
            data.options = [""]; data.correctAnswer = document.getElementById('manualAns').value.trim();
        }
        db.ref("bible_quiz/questions").push(data).then(() => { alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…"); document.getElementById('mQuestion').value = ""; });
    }

    function saveBulkNet() {
        const input = document.getElementById('bulkInput').value.trim();
        if(!input) return;
        input.split('\n').forEach(line => {
            if(line.includes('|')) {
                const parts = line.split('|');
                db.ref("bible_quiz/questions").push({ text: parts[0].trim(), correctAnswer: parts[1].trim(), type: "text", options: [""], points: parts[2] ? parseInt(parts[2].trim()) : 1 });
            }
        });
        alert("ØªÙ… âœ…"); document.getElementById('bulkInput').value = "";
    }

    /* ÙˆØ¸ÙŠÙØ© Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© */
    function loadResults() {
        db.ref("bible_quiz/submissions").once("value", snap => {
            const list = document.getElementById('resList'); list.innerHTML = "";
            if(!snap.exists()) { list.innerHTML = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬"; return; }
            snap.forEach(c => { 
                const data = c.val();
                let ansHtml = "";
                if(data.answers) {
                    data.answers.forEach((a, idx) => {
                        let color = (a.type === 'essay') ? '#fbbf24' : '#22c55e';
                        ansHtml += `<div style="margin-bottom:3px; border-bottom:1px solid rgba(255,255,255,0.05);">Ø³${idx+1}: <span style="color:${color}">${a.userAnswer || "Ù„Ø§ ØªÙˆØ¬Ø¯"}</span></div>`;
                    });
                }
                list.innerHTML += `
                <div style="padding: 10px; border-bottom: 1px solid #334155; background: rgba(255,255,255,0.02); border-radius: 8px; margin-bottom: 5px;">
                    <div style="display:flex; justify-content:space-between;">
                        <b>ğŸ‘¤ ${data.userName}</b>
                        <span style="color:#fbbf24; font-weight:bold;">${data.score}/${data.max}</span>
                    </div>
                    <div class="ans-detail-box">${ansHtml}</div>
                </div>`; 
            });
        });
    }

    function confirmClearQuiz() { 
        const password = prompt("Ø¨Ø§Ø³ÙˆÙˆØ±Ø¯ ØªØµÙÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©:");
        
        if (password !== "jesus 777") {
            alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø§Ø·Ø¦Ø© âŒ");
            return;
        }
        
        const doubleCheck = confirm("âš ï¸ ØªØ­Ø°ÙŠØ±!\n\nÙ‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØµÙÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ†ØŸ\n\nØ³ÙŠØªÙ…:\nâœ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…Ù† Firebase\nâœ… Ù…Ø³Ø­ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙˆØ§Ù„Ø¬Ø¯ÙŠØ¯\nâœ… Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø¬Ù…ÙŠØ¹ Ø¨Ø§Ù„Ø­Ù„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!");
        
        if (!doubleCheck) {
            alert("ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡ âŒ");
            return;
        }
        
        // Ù…Ø³Ø­ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ… (bible_quiz)
        db.ref("bible_quiz").remove()
            .then(() => {
                console.log("âœ… ØªÙ… Ù…Ø³Ø­ bible_quiz");
                
                // Ù…Ø³Ø­ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ (quiz_submissions)
                const currentQuizId = 'current_quiz_2026';
                return db.ref(`quiz_submissions/${currentQuizId}`).remove();
            })
            .then(() => {
                console.log("âœ… ØªÙ… Ù…Ø³Ø­ quiz_submissions");
                
                // ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„
                db.ref("activity_logs").push(`${currentServant}: ØµÙÙ‘Ø± Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ… + Ø§Ù„Ø¬Ø¯ÙŠØ¯)`);
                
                alert("âœ… ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­!\n\nğŸ‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ† ÙŠÙ…ÙƒÙ†Ù‡Ù… Ø§Ù„Ø¢Ù† Ø­Ù„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ù…Ù† Ø¬Ø¯ÙŠØ¯!\n\nâš ï¸ Ù…Ù„Ø­ÙˆØ¸Ø©: Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ† ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© (F5) Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©.");
            })
            .catch((error) => {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµÙÙŠØ±:", error);
                alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµÙÙŠØ±:\n" + error.message);
            });
    }

    function updatePrayerHints() {
        const hints = { agpeya: document.getElementById('adm_agpeya').value, thanks: document.getElementById('adm_thanks').value, forgive: document.getElementById('adm_forgive').value, heart: document.getElementById('adm_heart').value, union: document.getElementById('adm_union').value, verse: document.getElementById('adm_verse').value };
        db.ref("admin_prayer_hints").set(hints).then(() => alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ…"));
    }

    function loadCurrentHints() {
        db.ref("admin_prayer_hints").once("value", snap => {
            const d = snap.val(); if(d) {
                document.getElementById('adm_agpeya').value = d.agpeya || ""; document.getElementById('adm_thanks').value = d.thanks || ""; document.getElementById('adm_forgive').value = d.forgive || ""; document.getElementById('adm_heart').value = d.heart || ""; document.getElementById('adm_union').value = d.union || ""; document.getElementById('adm_verse').value = d.verse || "";
            }
        });
    }

    function renderUI() {
        const list = document.getElementById('leaderboard'); list.innerHTML = "";
        localData.sort((a,b) => b.score - a.score).forEach((p) => {
            const phoneDisplay = p.phone ? `<div style="font-size:10px; color:#94a3b8; margin-top:2px;">ğŸ“± ${p.phone}</div>` : '';
            list.innerHTML += `<div class="card"><div style="font-size:11px; font-weight:bold; height:28px; overflow:hidden;">${p.name}</div>${phoneDisplay}<div style="font-size:22px; font-weight:bold; color:#fbbf24;">${p.score}</div>
                <div class="edit-tools" style="display: ${isEditMode ? 'block' : 'none'}"><div class="plus-minus"><button onclick="updateScore('${p.id}', 1)" style="background:#475569">+1</button><button onclick="updateScore('${p.id}', 5)" style="background:#6366f1">+5</button><button onclick="updateScore('${p.id}', -1)" style="background:#ef4444">-1</button></div>
                <button onclick="resetSingleScore('${p.id}', '${p.name}')" style="background:#fb923c; width:100%; padding:8px; font-size:10px; margin-top:5px; font-weight:bold;">ğŸ”„ ØªØµÙÙŠØ±</button>
                <button onclick="deleteMakhdoum('${p.id}', '${p.name}')" style="color:#f87171; background:none; font-size:9px; margin-top:5px;">Ø­Ø°Ù Ø¢Ù…Ù† ğŸ”’</button></div></div>`;
        });
    }

    function updateScore(id, val) { 
        const m = localData.find(x => x.id === id);
        db.ref(`points_data/${id}`).transaction(current => {
            if (!current) return { score: val, lastUpdate: Date.now() };
            return { 
                ...current, 
                score: (current.score || 0) + val,
                lastUpdate: Date.now()
            };
        });
        db.ref("activity_logs").push(`${currentServant}: Ø¹Ø¯Ù„ ${m.name} (${val>0?'+':''}${val})`);
    }

    function addNewMakhdoum() { 
        const nameInp = document.getElementById('nameInp'); 
        const phoneInp = document.getElementById('phoneInp');
        if(nameInp.value.trim()) { 
            db.ref("points_data").push({ 
                name: nameInp.value.trim(), 
                phone: phoneInp.value.trim() || "",
                score: 0 
            }); 
            nameInp.value = ""; 
            phoneInp.value = "";
        } 
    }
    function sendAdminReply() { const inp = document.getElementById('adminReplyInp'); if(inp.value.trim()) { db.ref("chat").push({ sender: currentServant, text: inp.value.trim() }); inp.value = ""; } }
    function toggleLibVisibility() { db.ref("settings/libVisible").once("value", snap => db.ref("settings").update({ libVisible: !(snap.val() !== false) })); }
    function updateMediaLinks() { db.ref("media_library").set({ hymn: document.getElementById('hymnUrl').value, pdf: document.getElementById('pdfUrl').value, video: document.getElementById('videoUrl').value }).then(() => alert("ØªÙ… âœ…")); }
    function resetSingleScore(id, name) { 
        if (prompt(`ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„ØªØµÙÙŠØ± Ù†Ù‚Ø§Ø· ${name}:`) === "jesus 777") { 
            db.ref(`points_data/${id}/score`).set(0);
            db.ref("activity_logs").push(`${currentServant}: ØµÙÙ‘Ø± Ù†Ù‚Ø§Ø· ${name}`);
        } 
    }
    function deleteMakhdoum(id, name) { if (prompt(`Ø¨Ø§Ø³ÙˆÙˆØ±Ø¯ Ø­Ø°Ù (${name}):`) === "jesus 777") db.ref(`points_data/${id}`).remove(); }
    function togglePsyResponse(k, s) { db.ref(`psychology/confessions/${k}`).update({ responded: s }); }
    function deletePsyMsg(k) { if (prompt("Ø¨Ø§Ø³ÙˆÙˆØ±Ø¯ Ø§Ù„Ø­Ø°Ù:") === "jesus 777") db.ref(`psychology/confessions/${k}`).remove(); }
    function resetAllScores() { if (prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:") === "jesus 777" && confirm("ØªØµÙÙŠØ± Ø§Ù„Ø¬Ù…ÙŠØ¹ØŸ")) { let up = {}; localData.forEach(p => up[`points_data/${p.id}/score`] = 0); db.ref().update(up); } }
    function toggleEditMode() { isEditMode = !isEditMode; document.getElementById('modeBtn').innerText = isEditMode ? "âœ… Ø¥Ù†Ù‡Ø§Ø¡" : "ğŸ“ ØªØ¹Ø¯ÙŠÙ„"; document.getElementById('addArea').style.display = isEditMode ? "flex" : "none"; document.getElementById('resetBtn').style.display = isEditMode ? "block" : "none"; renderUI(); }
    function searchMakhdoum() { let f = document.getElementById('searchInput').value.toLowerCase(); document.querySelectorAll('#leaderboard .card').forEach(c => c.style.display = c.querySelector('div').innerText.toLowerCase().includes(f) ? "" : "none"); }
    function clearLog() { if(confirm("Ù…Ø³Ø­ØŸ")) db.ref("activity_logs").remove(); }
    function toggleChat() { db.ref("settings/chatEnabled").once("value", snap => db.ref("settings").update({ chatEnabled: !(snap.val() !== false) })); }
    function clearChatMessages() { if(confirm("Ù…Ø³Ø­ØŸ")) db.ref("chat").remove(); }
    function sendAlert() { db.ref("admin_announcement").set(document.getElementById('alertContent').value); }
    function clearAlert() { db.ref("admin_announcement").set(""); document.getElementById('alertContent').value = ""; }
    function replyPsy(sid) { const inp = document.getElementById('rep_' + sid); if(inp.value.trim()) { db.ref("psychology/private_chats/" + sid).push({ sender: "Ø§Ù„Ø®Ø§Ø¯Ù… (" + currentServant + ")", text: inp.value.trim() }); inp.value = ""; } }
    function delPsyChat(sid) { if(confirm("Ø­Ø°ÙØŸ")) db.ref("psychology/private_chats/" + sid).remove(); }
    
    function clearMakhdoumPointsDetails(makhdoumName) {
        if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙƒÙ„ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ù‚Ø§Ø· Ù„Ù€ "${makhdoumName}"ØŸ\n\nØ³ÙŠØªÙ… Ø­Ø°Ù:\nâ€¢ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª\nâ€¢ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©\nâ€¢ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±\n\nÙ…Ù„Ø­ÙˆØ¸Ø©: Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„ØªØ±ØªÙŠØ¨ Ù„Ù† ØªØªØ£Ø«Ø±!`)) return;
        
        const password = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„ØªØ£ÙƒÙŠØ¯:");
        if (password !== "jesus 777") {
            alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø§Ø·Ø¦Ø©!");
            return;
        }
        
        // Ø­Ø°Ù Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª
        db.ref("bible_quiz/submissions").once("value", snap => {
            const updates = {};
            snap.forEach(child => {
                if (child.val().userName === makhdoumName) {
                    updates[`bible_quiz/submissions/${child.key}`] = null;
                }
            });
            
            // Ø­Ø°Ù Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©
            db.ref("prayer_reports").once("value", snap2 => {
                snap2.forEach(child => {
                    if (child.val().makhdom === makhdoumName) {
                        updates[`prayer_reports/${child.key}`] = null;
                    }
                });
                
                // Ø­Ø°Ù Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±
                db.ref("attendance_logs").once("value", snap3 => {
                    snap3.forEach(child => {
                        if (child.val().makhdom === makhdoumName) {
                            updates[`attendance_logs/${child.key}`] = null;
                        }
                    });
                    
                    // ØªÙ†ÙÙŠØ° ÙƒÙ„ Ø§Ù„Ø­Ø°Ù Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©
                    db.ref().update(updates).then(() => {
                        alert(`ØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø³Ø¬Ù„Ø§Øª "${makhdoumName}" Ø¨Ù†Ø¬Ø§Ø­!\nØ§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„ØªØ±ØªÙŠØ¨ Ù„Ù… ØªØªØ£Ø«Ø±.`);
                        loadPointsBreakdown(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    });
                });
            });
        });
    }

    // ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´Ø¬ÙŠØ¹ Ù„Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ† Ø§Ù„ØºÙŠØ± Ù†Ø´Ø·ÙŠÙ† =====
    
    function getInactiveMakhdoumeen() {
        const now = Date.now();
        const threeDaysAgo = now - (3 * 24 * 60 * 60 * 1000); // 3 Ø£ÙŠØ§Ù…
        
        const inactive = localData.filter(person => {
            const lastUpdate = person.lastUpdate || 0;
            const hasLowScore = person.score < 15;
            const isInactive = lastUpdate < threeDaysAgo || lastUpdate === 0;
            
            return hasLowScore || isInactive;
        });
        
        return inactive.sort((a, b) => {
            const aLastUpdate = a.lastUpdate || 0;
            const bLastUpdate = b.lastUpdate || 0;
            return aLastUpdate - bLastUpdate; // Ø§Ù„Ø£Ù‚Ø¯Ù… Ø§Ù„Ø£ÙˆÙ„
        });
    }
    
    function displayInactiveList() {
        const inactive = getInactiveMakhdoumeen();
        const listDiv = document.getElementById('inactiveList');
        
        if (inactive.length === 0) {
            listDiv.innerHTML = `<div style="text-align:center; padding:20px; color:#22c55e;">
                <div style="font-size:40px; margin-bottom:10px;">ğŸ‰</div>
                <div style="font-weight:bold; font-size:16px;">Ù…Ø¨Ø±ÙˆÙƒ!</div>
                <div style="font-size:13px; margin-top:5px;">ÙƒÙ„ Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ† Ù†Ø´Ø·ÙŠÙ† ÙˆÙ…ØªÙØ§Ø¹Ù„ÙŠÙ†! ğŸ’ª</div>
            </div>`;
            return;
        }
        
        let html = `<div style="color:#fbbf24; font-weight:bold; margin-bottom:10px; font-size:13px;">
            Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ† Ø§Ù„Ù…Ø­ØªØ§Ø¬ÙŠÙ† ØªØ´Ø¬ÙŠØ¹: ${inactive.length}
        </div>`;
        
        inactive.forEach(person => {
            const lastUpdate = person.lastUpdate || 0;
            const daysSinceUpdate = lastUpdate > 0 ? Math.floor((Date.now() - lastUpdate) / (24 * 60 * 60 * 1000)) : 'âˆ';
            const phoneNumber = person.phone || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù…';
            
            let statusText = '';
            let statusColor = '';
            
            if (lastUpdate === 0) {
                statusText = 'Ù„Ù… ÙŠØ´Ø§Ø±Ùƒ Ø£Ø¨Ø¯Ø§Ù‹';
                statusColor = '#ef4444';
            } else if (daysSinceUpdate > 7) {
                statusText = `Ø¢Ø®Ø± Ù†Ø´Ø§Ø·: Ù‚Ø¨Ù„ ${daysSinceUpdate} ÙŠÙˆÙ…`;
                statusColor = '#f97316';
            } else if (daysSinceUpdate >= 3) {
                statusText = `Ø¢Ø®Ø± Ù†Ø´Ø§Ø·: Ù‚Ø¨Ù„ ${daysSinceUpdate} Ø£ÙŠØ§Ù…`;
                statusColor = '#eab308';
            } else {
                statusText = 'Ù†Ù‚Ø§Ø· Ù‚Ù„ÙŠÙ„Ø©';
                statusColor = '#fbbf24';
            }
            
            html += `<div class="inactive-card">
                <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:8px;">
                    <div>
                        <div style="font-weight:bold; font-size:15px; color:#fff; margin-bottom:5px;">${person.name}</div>
                        <div class="inactive-badge" style="background:${statusColor};">${statusText}</div>
                    </div>
                    <div style="font-size:24px; font-weight:bold; color:#fbbf24;">${person.score}</div>
                </div>
                
                <div style="font-size:12px; color:#94a3b8; margin-bottom:8px;">
                    ğŸ“± ${phoneNumber}
                </div>
                
                <div style="display:flex; gap:5px;">
                    <button class="contact-btn" onclick="callMakhdoum('${phoneNumber}')" style="flex:1;">
                        ğŸ“ Ø§ØªØµÙ„
                    </button>
                    <button class="contact-btn" onclick="whatsappMakhdoum('${phoneNumber}', '${person.name}')" style="flex:1; background:#25d366;">
                        ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨
                    </button>
                    <button class="contact-btn" onclick="sendDigitalEncouragement('${person.id}', '${person.name}')" style="flex:1; background:#6366f1;">
                        ğŸ“¨ Ø±Ø³Ø§Ù„Ø©
                    </button>
                </div>
            </div>`;
        });
        
        listDiv.innerHTML = html;
    }
    
    function toggleInactiveList() {
        const listDiv = document.getElementById('inactiveList');
        if (listDiv.style.display === 'none') {
            listDiv.style.display = 'block';
            displayInactiveList();
        } else {
            listDiv.style.display = 'none';
        }
    }
    
    function sendEncouragementToAll() {
        const inactive = getInactiveMakhdoumeen();
        
        if (inactive.length === 0) {
            alert('ÙƒÙ„ Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ† Ù†Ø´Ø·ÙŠÙ†! ğŸ‰ Ù…ÙÙŠØ´ Ø­Ø¯ Ù…Ø­ØªØ§Ø¬ ØªØ´Ø¬ÙŠØ¹ Ø¯Ù„ÙˆÙ‚ØªÙŠ.');
            return;
        }
        
        if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ ØªØ´Ø¬ÙŠØ¹ÙŠØ© Ù„Ù€ ${inactive.length} Ù…Ø®Ø¯ÙˆÙ…ØŸ\n\nØ³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„ÙƒÙ„ ÙˆØ§Ø­Ø¯ ÙÙŠÙ‡Ù….`)) {
            return;
        }
        
        const timestamp = Date.now();
        const updates = {};
        
        inactive.forEach(person => {
            const messageId = `${person.id}_${timestamp}`;
            updates[`encouragement_messages/${messageId}`] = {
                to: person.name,
                toId: person.id,
                from: currentServant,
                message: `ÙˆØ­Ø´ØªÙ†Ø§ ÙŠØ§ ${person.name}! ğŸ’™\nØ§Ø­Ù†Ø§ Ù…Ø­ØªØ§Ø¬ÙŠÙ†Ùƒ Ù…Ø¹Ø§Ù†Ø§ ÙÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©.\nØ±Ø¨Ù†Ø§ ÙŠÙØ±Ø­ Ù‚Ù„Ø¨Ùƒ ÙˆÙŠÙ‚ÙˆÙŠÙƒ! ğŸ™`,
                timestamp: timestamp,
                read: false
            };
        });
        
        db.ref().update(updates).then(() => {
            alert(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ${inactive.length} Ø±Ø³Ø§Ù„Ø© ØªØ´Ø¬ÙŠØ¹ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­! âœ…\n\nØ§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù‡ØªØ¸Ù‡Ø± Ù„Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ† Ù„Ù…Ø§ ÙŠÙØªØ­ÙˆØ§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.`);
            db.ref("activity_logs").push(`${currentServant}: Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ø¦Ù„ ØªØ´Ø¬ÙŠØ¹ÙŠØ© Ù„Ù€ ${inactive.length} Ù…Ø®Ø¯ÙˆÙ…`);
        });
    }
    
    function sendDigitalEncouragement(personId, personName) {
        const message = prompt(`Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© ØªØ´Ø¬ÙŠØ¹ÙŠØ© Ù„Ù€ ${personName}:`, `ÙˆØ­Ø´ØªÙ†Ø§ ÙŠØ§ ${personName}! ğŸ’™ Ø¹Ø§ÙŠØ²ÙŠÙ† Ù†Ø´ÙˆÙÙƒ Ù…Ø¹Ø§Ù†Ø§ ÙÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©.`);
        
        if (!message || message.trim() === '') return;
        
        const messageId = `${personId}_${Date.now()}`;
        db.ref(`encouragement_messages/${messageId}`).set({
            to: personName,
            toId: personId,
            from: currentServant,
            message: message.trim(),
            timestamp: Date.now(),
            read: false
        }).then(() => {
            alert(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù€ ${personName} Ø¨Ù†Ø¬Ø§Ø­! âœ…`);
            db.ref("activity_logs").push(`${currentServant}: Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© ØªØ´Ø¬ÙŠØ¹ÙŠØ© Ù„Ù€ ${personName}`);
        });
    }
    
    function callMakhdoum(phone) {
        if (phone === 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù…') {
            alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… ØªÙ„ÙŠÙÙˆÙ† Ù…Ø³Ø¬Ù„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø®Ø¯ÙˆÙ….');
            return;
        }
        window.location.href = `tel:${phone}`;
    }
    
    function whatsappMakhdoum(phone, name) {
        if (phone === 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù…') {
            alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø³Ø¬Ù„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø®Ø¯ÙˆÙ….');
            return;
        }
        
        const message = `Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙŠØ§ ${name}! ğŸ’™\n\nÙˆØ­Ø´ØªÙ†Ø§ ÙÙŠ Ø®Ø¯Ù…Ø© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ ÙˆØ¹Ø§ÙŠØ²ÙŠÙ† Ù†Ø´ÙˆÙÙƒ Ù…Ø¹Ø§Ù†Ø§.\nØ±Ø¨Ù†Ø§ ÙŠÙØ±Ø­ Ù‚Ù„Ø¨Ùƒ! ğŸ™`;
        const encodedMessage = encodeURIComponent(message);
        
        // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ù…Ø³Ø§ÙØ§Øª Ø£Ùˆ Ø£Ø­Ø±Ù Ø®Ø§ØµØ© Ù…Ù† Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†
        const cleanPhone = phone.replace(/[^0-9+]/g, '');
        
        window.open(`https://wa.me/${cleanPhone}?text=${encodedMessage}`, '_blank');
    }
    
    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØºÙŠØ± Ù†Ø´Ø·ÙŠÙ† ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
    setInterval(() => {
        const listDiv = document.getElementById('inactiveList');
        if (listDiv.style.display !== 'none') {
            displayInactiveList();
        }
    }, 60000); // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©

</script>
</body>
</html>
